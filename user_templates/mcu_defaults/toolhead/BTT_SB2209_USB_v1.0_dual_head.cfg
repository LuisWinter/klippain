#--------------------------------------------#
##### BTT SB2209 USB v1.0 MCU definition #####
#--------------------------------------------#

[mcu toolhead_0]
##--------------------------------------------------------------------
serial: /dev/serial/by-id/change-me-to-the-correct-mcu-path
##--------------------------------------------------------------------

[mcu toolhead_1]
##--------------------------------------------------------------------
serial: /dev/serial/by-id/change-me-to-the-correct-mcu-path
##--------------------------------------------------------------------


# If you want to override the wiring of the BTT SB, keep in mind that this
# board is defined using the "toolhead" name. So you should use "pin: toolhead:PIN_NAME"
# in your own overrides.cfg files.

[include config/mcu_definitions/toolhead/BTT_SB2209_USB_v1.0.cfg] # Do not remove this line
[board_pins sb2209_usb_mcu]
mcu: toolhead_0, toolhead_1
aliases:

    E_STEP=MCU_E0_STEP , E_DIR=MCU_E0_DIR , E_ENABLE=MCU_E0_EN , E_TMCUART=MCU_E0_UART ,

    X_STOP=MCU_ENDSTOP ,
    PROBE_INPUT=MCU_PROBE1  , PROBE_SENSE=MCU_PROBE2 ,

    E_HEATER=MCU_HE0  ,
    E_TEMPERATURE=MCU_TH0 ,
    TH_MCU_NTC=MCU_NTC ,

    IND_NPN=MCU_IND       , FAN0=MCU_FAN        ,
    FAN1=MCU_FAN1_PWM   , FAN2=MCU_FAN2_PWM   ,
    FAN3_TACH=MCU_4WFAN_TACH , FAN3=MCU_4WFAN_PWM ,

    LIS2DW_MISO=MCU_LIS2DW_MISO , LIS2DW_CS=MCU_LIS2DW_CS     , LIS2DW_CK=MCU_LIS2DW_CK  , 
    LIS2DW_MOSI=MCU_LIS2DW_MOSI , LIS2DW_INT1=MCU_LIS2DW_INT1  , 
    
    I2C_SCL=MCU_I2C_SCL    , I2C_SDA=MCU_I2C_SDA      ,

    TOOLHEAD_RGB=MCU_RGB    , STATUS_LED=MCU_STATUS


#----------------------------------------#
#    BTT SB2209 v1.0 pins remapping      #
#----------------------------------------#

[extruder]
step_pin: toolhead_0:E_STEP
dir_pin: !toolhead_0:E_DIR
enable_pin: !toolhead_0:E_ENABLE
heater_pin: toolhead_0:E_HEATER
pullup_resistor: 2200 # 2.2K
sensor_pin: toolhead_0:E_TEMPERATURE

[extruder1]
step_pin: toolhead_1:E_STEP
dir_pin: !toolhead_1:E_DIR
enable_pin: !toolhead_1:E_ENABLE
heater_pin: toolhead_1:E_HEATER
pullup_resistor: 2200 # 2.2K
sensor_pin: toolhead_1:E_TEMPERATURE

[tmc2209 extruder]
uart_pin: toolhead_0:E_TMCUART

[tmc2209 extruder1]
uart_pin: toolhead_1:E_TMCUART


[dual_carriage] # B stepper - Left for Tridex
endstop_pin: toolhead_1: MCU_ENDSTOP



[fan] # fan1
pin: toolhead_0:FAN1

[fan] # fan1
pin: toolhead_1:FAN1  #muss noch genauer angeschaut werden

[heater_fan hotend_fan] # fan2
pin: toolhead_0:FAN2
heater: extruder


[heater_fan hotend1_fan] # fan2
pin: toolhead_1:FAN2
heater: extruder1




[neopixel hotend_0_rgb]
pin: toolhead_0:TOOLHEAD_RGB

[neopixel hotend_1_rgb]
pin: toolhead_1:TOOLHEAD_RGB

[temperature_sensor toolhead_0_mcu]
sensor_type: Generic 3950
sensor_pin: toolhead_0:TH_MCU_NTC
min_temp = 0
max_temp = 100

[temperature_sensor toolhead_1_mcu]
sensor_type: Generic 3950
sensor_pin: toolhead_0:TH_MCU_NTC
min_temp = 0
max_temp = 100




#### LIS2DW Input Shaper ####
# Change probe_points to best location for resonance testing
# Include the IS calibration macros to unlock them when
# an accelerometer is installed on the machine
[lis2dw toolhead_0]
cs_pin: toolhead_0:LIS2DW_CS
spi_bus: spi0a
axes_map: x,y,z

[lis2dw toolhead_1]
cs_pin: toolhead_1:LIS2DW_CS
spi_bus: spi0a
axes_map: x,y,z

[resonance_tester]
accel_chip: lis2dw toolboard_0
probe_points: 125,125,20

[resonance_tester]
accel_chip: lis2dw toolboard_1
probe_points: 125,125,20

[include ./macros/helpers/resonance_override.cfg]
[include ./scripts/K-ShakeTune/K-SnT_*.cfg]

